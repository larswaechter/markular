<div class="wrapper">
  <div class="toolbar">
    <div class="actions">
      @if (!showPreview) {
        @for (headline of _options().toolbar.headings; track $index) {
          <button
            [title]="'Heading ' + headline"
            [class.active]="isFocused && isHeading(headline)"
            (click)="toggleHeading(headline)"
          >
            H{{ headline }}
          </button>
        }
        @if (_options().toolbar.headings?.length) {
          <div class="separator"></div>
        }

        @if (_options().toolbar.emphasis?.bold) {
          <button title="Bold" [class.active]="isBold()" (click)="toggleBold()"><b>B</b></button>
        }
        @if (_options().toolbar.emphasis?.italic) {
          <button title="Italic" [class.active]="isItalic()" (click)="toggleItalic()">
            <i>I</i>
          </button>
        }
        @if (_options().toolbar.emphasis?.bold || _options().toolbar.emphasis?.italic) {
          <div class="separator"></div>
        }

        @if (_options().toolbar.lists?.unordered) {
          <button
            title="Unordered List"
            [class.active]="isFocused && isUnorderedList()"
            (click)="toggleUnorderedList()"
          >
            <svg
              aria-hidden="true"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
            >
              <path
                stroke="currentColor"
                stroke-linecap="round"
                stroke-width="2"
                d="M9 8h10M9 12h10M9 16h10M4.99 8H5m-.02 4h.01m0 4H5"
              />
            </svg>
          </button>
        }
        @if (_options().toolbar.lists?.ordered) {
          <button
            title="Ordered List"
            [class.active]="isFocused && isOrderedList()"
            (click)="toggleOrderedList()"
          >
            <svg
              aria-hidden="true"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
            >
              <path
                stroke="currentColor"
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 6h8m-8 6h8m-8 6h8M4 16a2 2 0 1 1 3.321 1.5L4 20h5M4 5l2-1v6m-2 0h4"
              />
            </svg>
          </button>
        }
        @if (_options().toolbar.lists?.unordered || _options().toolbar.lists?.ordered) {
          <div class="separator"></div>
        }

        @if (_options().toolbar.blockquote) {
          <button
            title="Block Quote"
            [class.active]="isFocused && isQuote()"
            (click)="toggleQuote()"
          >
            <svg
              aria-hidden="true"
              xmlns="http://www.w3.org/2000/svg"
              fill="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                fill-rule="evenodd"
                d="M6 6a2 2 0 0 0-2 2v3a2 2 0 0 0 2 2h3a3 3 0 0 1-3 3H5a1 1 0 1 0 0 2h1a5 5 0 0 0 5-5V8a2 2 0 0 0-2-2H6Zm9 0a2 2 0 0 0-2 2v3a2 2 0 0 0 2 2h3a3 3 0 0 1-3 3h-1a1 1 0 1 0 0 2h1a5 5 0 0 0 5-5V8a2 2 0 0 0-2-2h-3Z"
                clip-rule="evenodd"
              />
            </svg>
          </button>
        }
        @if (_options().toolbar.code?.block) {
          <button
            title="Code Block"
            [class.active]="isFocused && isCodeBlock()"
            (click)="toggleCodeBlock()"
          >
            <svg
              class="w-6 h-6 text-gray-800 dark:text-white"
              aria-hidden="true"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
            >
              <path
                stroke="currentColor"
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M10 3v4a1 1 0 0 1-1 1H5m5 4-2 2 2 2m4-4 2 2-2 2m5-12v16a1 1 0 0 1-1 1H6a1 1 0 0 1-1-1V7.914a1 1 0 0 1 .293-.707l3.914-3.914A1 1 0 0 1 9.914 3H18a1 1 0 0 1 1 1Z"
              />
            </svg>
          </button>
        }
        @if (_options().toolbar.code?.inline) {
          <button
            title="Inline Code"
            [class.active]="isFocused && isInlineCode()"
            (click)="toggleInlineCode()"
          >
            <svg
              class="w-6 h-6 text-gray-800 dark:text-white"
              aria-hidden="true"
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              fill="none"
              viewBox="0 0 24 24"
            >
              <path
                stroke="currentColor"
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="m8 8-4 4 4 4m8 0 4-4-4-4m-2-3-4 14"
              />
            </svg>
          </button>
        }
        @if (_options().toolbar.horizontalRule) {
          <button
            title="Horizontal Divider"
            [class.active]="isFocused && isDivider()"
            (click)="toggleDivider()"
          >
            <svg
              aria-hidden="true"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
            >
              <path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M5 12h14" />
              <path
                stroke="currentColor"
                stroke-linecap="round"
                d="M6 9.5h12m-12-2h12m-12-2h12m-12 13h12m-12-2h12m-12-2h12"
              />
            </svg>
          </button>
        }
        @if (_options().toolbar.blockquote ||
        _options().toolbar.code?.block ||
        _options().toolbar.code?.inline ||
        _options().toolbar.horizontalRule) {
          <div class="separator"></div>
        }

        @if (_options().toolbar.hyperlink) {
          <button title="Hyperlink" [class.active]="isFocused && isLink()" (click)="applyLink()">
            <svg
              aria-hidden="true"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
            >
              <path
                stroke="currentColor"
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M13.213 9.787a3.391 3.391 0 0 0-4.795 0l-3.425 3.426a3.39 3.39 0 0 0 4.795 4.794l.321-.304m-.321-4.49a3.39 3.39 0 0 0 4.795 0l3.424-3.426a3.39 3.39 0 0 0-4.794-4.795l-1.028.961"
              />
            </svg>
          </button>
        }

        @if (_options().toolbar.image) {
          <button title="Image" [class.active]="isFocused && isImage()" (click)="applyImage()">
            <svg
              class="w-6 h-6 text-gray-800 dark:text-white"
              aria-hidden="true"
              xmlns="http://www.w3.org/2000/svg"
              fill="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                fill-rule="evenodd"
                d="M13 10a1 1 0 0 1 1-1h.01a1 1 0 1 1 0 2H14a1 1 0 0 1-1-1Z"
                clip-rule="evenodd"
              />
              <path
                fill-rule="evenodd"
                d="M2 6a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v12c0 .556-.227 1.06-.593 1.422A.999.999 0 0 1 20.5 20H4a2.002 2.002 0 0 1-2-2V6Zm6.892 12 3.833-5.356-3.99-4.322a1 1 0 0 0-1.549.097L4 12.879V6h16v9.95l-3.257-3.619a1 1 0 0 0-1.557.088L11.2 18H8.892Z"
                clip-rule="evenodd"
              />
            </svg>
          </button>
        }

        <div class="separator"></div>
        

        <button title="Undo" [disabled]="!canUndo()" (click)="undo()">
          <svg class="w-6 h-6 text-gray-800 dark:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"
               width="24" height="24" fill="none" viewBox="0 0 24 24">
            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M3 9h13a5 5 0 0 1 0 10H7M3 9l4-4M3 9l4 4" />
          </svg>

        </button>
        <button title="Redo" [disabled]="!canRedo()" (click)="redo()">
          <svg class="w-6 h-6 text-gray-800 dark:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"
               width="24" height="24" fill="none" viewBox="0 0 24 24">
            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M21 9H8a5 5 0 0 0 0 10h9m4-10-4-4m4 4-4 4" />
          </svg>
        </button>
      }
    </div>

    <button (click)="togglePreview()" class="previewBtn">
      @if (showPreview) {
        <svg
          class="w-6 h-6 text-gray-800 dark:text-white"
          aria-hidden="true"
          xmlns="http://www.w3.org/2000/svg"
          fill="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            fill-rule="evenodd"
            d="M14 4.182A4.136 4.136 0 0 1 16.9 3c1.087 0 2.13.425 2.899 1.182A4.01 4.01 0 0 1 21 7.037c0 1.068-.43 2.092-1.194 2.849L18.5 11.214l-5.8-5.71 1.287-1.31.012-.012Zm-2.717 2.763L6.186 12.13l2.175 2.141 5.063-5.218-2.141-2.108Zm-6.25 6.886-1.98 5.849a.992.992 0 0 0 .245 1.026 1.03 1.03 0 0 0 1.043.242L10.282 19l-5.25-5.168Zm6.954 4.01 5.096-5.186-2.218-2.183-5.063 5.218 2.185 2.15Z"
            clip-rule="evenodd"
          />
        </svg>
      } @else {
        <svg
          class="w-6 h-6 text-gray-800 dark:text-white"
          aria-hidden="true"
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
        >
          <path
            stroke="currentColor"
            stroke-width="2"
            d="M21 12c0 1.2-4.03 6-9 6s-9-4.8-9-6c0-1.2 4.03-6 9-6s9 4.8 9 6Z"
          />
          <path stroke="currentColor" stroke-width="2" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
        </svg>
      }
    </button>
  </div>

  <div [hidden]="!showPreview" [innerHTML]="preview" class="preview"></div>
  <textarea
    #editor
    (click)="cacheSelection(editor)"
    (focusin)="toggleFocused()"
    (focusout)="toggleFocused()"
    (input)="onInput(editor)"
    (keyup)="cacheSelection(editor)"
    [disabled]="isDisabled"
    [hidden]="showPreview"
    [placeholder]="this.placeholder()"
    [rows]="this.rows()"
    [value]="_val"
  ></textarea>
</div>
